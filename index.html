<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Datos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; color: #334155; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; padding: 30px 0; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .card { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0; }
        .card-title { color: #3b82f6; font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { color: #3b82f6; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }
        .form-group input, .form-group textarea, .form-group select { padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease; background-color: #ffffff; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover { background-color: #2563eb; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .btn-secondary { background-color: #6b7280; color: white; }
        .btn-secondary:hover { background-color: #4b5563; }
        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; }
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-warning:hover { background-color: #d97706; }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        .search-container { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 300px; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
        .view-toggle { display: flex; background-color: #f1f5f9; border-radius: 8px; padding: 4px; }
        .view-toggle button { padding: 8px 16px; border: none; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; }
        .view-toggle button.active { background-color: #3b82f6; color: white; }
        .table-container { overflow-x: auto; border-radius: 8px; border: 1px solid #e2e8f0; }
        .data-table { width: 100%; border-collapse: collapse; background: white; }
        .data-table th { background-color: #f8fafc; color: #3b82f6; font-weight: 600; padding: 15px 12px; text-align: left; border-bottom: 2px solid #e2e8f0; cursor: pointer; user-select: none; transition: background-color 0.3s ease; }
        .data-table th:hover { background-color: #f1f5f9; }
        .data-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .data-table tr:hover { background-color: #f8fafc; }
        .record-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; border: 1px solid #e2e8f0; transition: all 0.3s ease; }
        .record-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        .record-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
        .record-name { font-size: 1.2rem; font-weight: 600; color: #1e293b; }
        .record-actions { display: flex; gap: 8px; }
        .record-actions button { padding: 6px 12px; font-size: 0.875rem; }
        .record-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .record-field { display: flex; flex-direction: column; }
        .record-field-label { color: #3b82f6; font-weight: 600; font-size: 0.875rem; margin-bottom: 4px; }
        .record-field-value { color: #4b5563; font-size: 0.95rem; white-space: pre-wrap; }
        .long-text { grid-column: 1 / -1; }
        .loading { text-align: center; padding: 40px; color: #6b7280; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
        .empty-state h3 { margin-bottom: 10px; color: #374151; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
        .modal-title { color: #3b82f6; font-size: 1.5rem; font-weight: 600; }
        .close { color: #6b7280; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s ease; }
        .close:hover { color: #374151; }
        .sort-indicator { margin-left: 8px; font-size: 0.8rem; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; color: white; font-weight: 600; z-index: 1001; transform: translateX(400px); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #10b981; }
        .notification.error { background-color: #ef4444; }
        .notification.info { background-color: #3b82f6; }
        .hidden { display: none !important; }
        .no-print { }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .card { padding: 20px; }
            .form-grid { grid-template-columns: 1fr; }
            .search-container { flex-direction: column; align-items: stretch; }
            .search-input { min-width: auto; }
            .btn-group { justify-content: center; }
            .modal-content { margin: 10% auto; width: 95%; padding: 20px; }
        }
        /* Estilos de impresi√≥n */
        @media print {
            body { background: #fff; }
            .no-print, .no-print * { display: none !important; }
            .container { max-width: 100%; padding: 0 10mm; }
            .record-card { page-break-inside: avoid; border: 1px solid #e5e7eb; box-shadow: none; }
            .record-header { border-bottom: 1px solid #e5e7eb; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header no-print">
            <p>Registro de datos de partes en procesos judiciales</p>
        </div>

        <!-- Formulario de Registro -->
        <div class="card no-print">
            <h2 class="card-title">Nuevo Registro</h2>
            <form id="registroForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="apellido">Apellido *</label>
                        <input type="text" id="apellido" name="apellido" required />
                    </div>
                    <div class="form-group">
                        <label for="nombre">Nombre *</label>
                        <input type="text" id="nombre" name="nombre" required />
                    </div>
                    <div class="form-group">
                        <label for="dni">DNI *</label>
                        <input type="text" id="dni" name="dni" required pattern="[0-9]{7,8}" />
                    </div>
                    <div class="form-group">
                        <label for="domicilio">Domicilio</label>
                        <input type="text" id="domicilio" name="domicilio" />
                    </div>
                    <div class="form-group">
                        <label for="ciudad">Ciudad</label>
                        <input type="text" id="ciudad" name="ciudad" />
                    </div>
                    <div class="form-group">
                        <label for="telefono">Tel√©fono</label>
                        <input type="text" id="telefono" name="telefono" />
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="text" id="email" name="email" />
                    </div>
                    <div class="form-group">
                        <label for="datosAntecedentes">Datos Judiciales Antecedentes</label>
                        <textarea id="datosAntecedentes" name="datosAntecedentes" placeholder="Describa los datos judiciales previos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="situacionMedica">Situaci√≥n M√©dica</label>
                        <textarea id="situacionMedica" name="situacionMedica" placeholder="Describa la situaci√≥n m√©dica relevante..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="situacionLaboral">Situaci√≥n Laboral</label>
                        <textarea id="situacionLaboral" name="situacionLaboral" placeholder="Describa la situaci√≥n laboral actual..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="observaciones">Otras Observaciones</label>
                        <textarea id="observaciones" name="observaciones" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <span>üíæ</span> Guardar Registro
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="limpiarFormulario()">
                        <span>üóëÔ∏è</span> Limpiar Formulario
                    </button>
                </div>
            </form>
        </div>

        <!-- Panel de Control -->
        <div class="card no-print">
            <h2 class="card-title">Gesti√≥n de Registros</h2>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar en todos los campos..." />
                <button class="btn btn-primary" onclick="buscarRegistros()">
                    <span>üîç</span> Buscar
                </button>
                <div class="view-toggle">
                    <button id="viewCompact" class="active" onclick="cambiarVista('compact')">Vista Compacta</button>
                    <button id="viewComplete" onclick="cambiarVista('complete')">Vista Completa</button>
                </div>
                <button class="btn btn-success" onclick="cargarTodosLosRegistros()">
                    <span>üîÑ</span> Actualizar
                </button>
                <!-- NUEVO: Imprimir listado completo -->
                <button class="btn btn-secondary" onclick="printListadoCompleto()">
                    <span>üñ®Ô∏è</span> Imprimir listado completo
                </button>
            </div>

            <!-- Vista de Tabla (Compacta) -->
            <div id="tableView" class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="ordenarPor('apellido')">Apellido <span class="sort-indicator" id="sort-apellido"></span></th>
                            <th onclick="ordenarPor('nombre')">Nombre <span class="sort-indicator" id="sort-nombre"></span></th>
                            <th onclick="ordenarPor('dni')">DNI <span class="sort-indicator" id="sort-dni"></span></th>
                            <th onclick="ordenarPor('ciudad')">Ciudad <span class="sort-indicator" id="sort-ciudad"></span></th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="5" class="loading">Cargando registros...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Vista de Tarjetas (Completa) -->
            <div id="cardView" class="hidden">
                <div id="cardContainer">
                    <div class="loading">Cargando registros...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ver/Editar -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Detalle del Registro</h2>
                <span class="close" onclick="cerrarModal()">&times;</span>
            </div>
            <div id="modalContent"><!-- Contenido din√°mico --></div>
        </div>
    </div>

    <!-- Notificaciones -->
    <div id="notification" class="notification"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Configuraci√≥n de Firebase (igual que original)
        const firebaseConfig = {
            apiKey: "AIzaSyC871IwG89d3yd-BUY9tj2q0_gmBV3AMfM",
            authDomain: "datos-partes.firebaseapp.com",
            databaseURL: "https://datos-partes-default-rtdb.firebaseio.com",
            projectId: "datos-partes",
            storageBucket: "datos-partes.firebasestorage.app",
            messagingSenderId: "277413385546",
            appId: "1:277413385546:web:9863aaa081727a84479db3"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variables globales
        let registros = [];
        let registroEditando = null;
        let vistaActual = 'compact';
        let ordenActual = { campo: 'apellido', direccion: 'asc' };

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function () {
            cargarTodosLosRegistros();
            document.getElementById('registroForm').addEventListener('submit', function (e) {
                e.preventDefault();
                guardarRegistro();
            });
            document.getElementById('searchInput').addEventListener('input', function () {
                buscarRegistros();
            });
            actualizarIndicadoresOrden();
        });

        // Guardar registro
        function guardarRegistro() {
            const formData = new FormData(document.getElementById('registroForm'));
            const registro = {};
            for (let [key, value] of formData.entries()) {
                registro[key] = value.trim();
            }
            if (!registro.apellido || !registro.nombre || !registro.dni) {
                mostrarNotificacion('Por favor complete los campos obligatorios', 'error');
                return;
            }
            registro.fechaCreacion = new Date().toISOString();
            registro.fechaModificacion = new Date().toISOString();

            if (registroEditando) {
                database.ref('registros/' + registroEditando).update(registro)
                    .then(() => {
                        mostrarNotificacion('Registro actualizado exitosamente', 'success');
                        limpiarFormulario();
                        cerrarModal();
                        cargarTodosLosRegistros();
                        registroEditando = null;
                    })
                    .catch((error) => mostrarNotificacion('Error al actualizar: ' + error.message, 'error'));
            } else {
                database.ref('registros').push(registro)
                    .then(() => {
                        mostrarNotificacion('Registro guardado exitosamente', 'success');
                        limpiarFormulario();
                        cargarTodosLosRegistros();
                    })
                    .catch((error) => mostrarNotificacion('Error al guardar: ' + error.message, 'error'));
            }
        }

        // Cargar todos los registros
        function cargarTodosLosRegistros() {
            database.ref('registros').once('value')
                .then((snapshot) => {
                    registros = [];
                    snapshot.forEach((childSnapshot) => {
                        const registro = childSnapshot.val();
                        registro.id = childSnapshot.key;
                        registros.push(registro);
                    });
                    ordenarRegistros();
                    mostrarRegistros();
                })
                .catch((error) => mostrarNotificacion('Error al cargar registros: ' + error.message, 'error'));
        }

        // Mostrar seg√∫n vista
        function mostrarRegistros() {
            if (vistaActual === 'compact') {
                mostrarVistaTabla();
            } else {
                mostrarVistaTarjetas();
            }
        }

        function mostrarVistaTabla() {
            const tbody = document.getElementById('tableBody');
            if (registros.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><h3>No hay registros</h3><p>Agregue el primer registro usando el formulario superior</p></td></tr>';
                return;
            }
            tbody.innerHTML = registros.map(registro => `
                <tr>
                    <td>${registro.apellido || '-'}</td>
                    <td>${registro.nombre || '-'}</td>
                    <td>${registro.dni || '-'}</td>
                    <td>${registro.ciudad || '-'}</td>
                    <td>
                        <div class="record-actions">
                            <button class="btn btn-primary" onclick="verRegistro('${registro.id}')" title="Ver">üëÅÔ∏è</button>
                            <button class="btn btn-warning" onclick="editarRegistro('${registro.id}')" title="Editar">‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="eliminarRegistro('${registro.id}')" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // VISTA COMPLETA: TODOS LOS CAMPOS (sin truncar)
        function mostrarVistaTarjetas() {
            const container = document.getElementById('cardContainer');
            if (registros.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No hay registros</h3><p>Agregue el primer registro usando el formulario superior</p></div>';
                return;
            }
            container.innerHTML = registros.map(registro => `
                <div class="record-card">
                    <div class="record-header">
                        <div class="record-name">${registro.apellido || ''} ${registro.nombre || ''}</div>
                        <div class="record-actions no-print">
                            <button class="btn btn-primary" onclick="verRegistro('${registro.id}')" title="Ver">üëÅÔ∏è</button>
                            <button class="btn btn-warning" onclick="editarRegistro('${registro.id}')" title="Editar">‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="eliminarRegistro('${registro.id}')" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="record-details">
                        ${campo('Apellido', registro.apellido)}
                        ${campo('Nombre', registro.nombre)}
                        ${campo('DNI', registro.dni)}
                        ${campo('Domicilio', registro.domicilio)}
                        ${campo('Ciudad', registro.ciudad)}
                        ${campo('Tel√©fono', registro.telefono)}
                        ${campo('Email', registro.email)}
                        ${campoLargo('Datos Judiciales Antecedentes', registro.datosAntecedentes)}
                        ${campoLargo('Situaci√≥n M√©dica', registro.situacionMedica)}
                        ${campoLargo('Situaci√≥n Laboral', registro.situacionLaboral)}
                        ${campoLargo('Otras Observaciones', registro.observaciones)}
                    </div>
                </div>
            `).join('');
        }

        // Helpers para componer campos (vista completa)
        function safe(v) { return (v && String(v).trim()) ? String(v) : '-'; }
        function campo(label, value) {
            return `
            <div class="record-field">
                <div class="record-field-label">${label}</div>
                <div class="record-field-value">${safe(value)}</div>
            </div>`;
        }
        function campoLargo(label, value) {
            return `
            <div class="record-field long-text">
                <div class="record-field-label">${label}</div>
                <div class="record-field-value">${safe(value)}</div>
            </div>`;
        }

        // Cambiar vista
        function cambiarVista(vista) {
            vistaActual = vista;
            document.getElementById('viewCompact').classList.toggle('active', vista === 'compact');
            document.getElementById('viewComplete').classList.toggle('active', vista === 'complete');
            document.getElementById('tableView').classList.toggle('hidden', vista !== 'compact');
            document.getElementById('cardView').classList.toggle('hidden', vista !== 'complete');
            mostrarRegistros();
        }

        // Buscar
        function buscarRegistros() {
            const termino = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!termino) { cargarTodosLosRegistros(); return; }
            const registrosFiltrados = registros.filter(registro => {
                return Object.values(registro).some(valor => valor && valor.toString().toLowerCase().includes(termino));
            });
            const original = registros;
            registros = registrosFiltrados;
            mostrarRegistros();
            registros = original;
        }

        // Ordenar
        function ordenarPor(campo) {
            if (ordenActual.campo === campo) {
                ordenActual.direccion = ordenActual.direccion === 'asc' ? 'desc' : 'asc';
            } else {
                ordenActual.campo = campo; ordenActual.direccion = 'asc';
            }
            ordenarRegistros();
            mostrarRegistros();
            actualizarIndicadoresOrden();
        }
        function ordenarRegistros() {
            registros.sort((a, b) => {
                const valorA = (a[ordenActual.campo] || '').toString().toLowerCase();
                const valorB = (b[ordenActual.campo] || '').toString().toLowerCase();
                return (ordenActual.direccion === 'asc') ? valorA.localeCompare(valorB) : valorB.localeCompare(valorA);
            });
        }
        function actualizarIndicadoresOrden() {
            document.querySelectorAll('.sort-indicator').forEach(el => el.textContent = '');
            const indicador = document.getElementById('sort-' + ordenActual.campo);
            if (indicador) indicador.textContent = ordenActual.direccion === 'asc' ? '‚Üë' : '‚Üì';
        }

        // Ver registro (con bot√≥n Imprimir en modal)
        function verRegistro(id) {
            const registro = registros.find(r => r.id === id);
            if (!registro) return;
            document.getElementById('modalTitle').textContent = 'Detalle del Registro';
            document.getElementById('modalContent').innerHTML = `
                <div class="form-grid">
                    ${bloqueDetalle('Apellido', registro.apellido)}
                    ${bloqueDetalle('Nombre', registro.nombre)}
                    ${bloqueDetalle('DNI', registro.dni)}
                    ${bloqueDetalle('Domicilio', registro.domicilio)}
                    ${bloqueDetalle('Ciudad', registro.ciudad)}
                    ${bloqueDetalle('Tel√©fono', registro.telefono)}
                    ${bloqueDetalle('Email', registro.email)}
                    ${bloqueDetalle('Datos Judiciales Antecedentes', registro.datosAntecedentes, true)}
                    ${bloqueDetalle('Situaci√≥n M√©dica', registro.situacionMedica, true)}
                    ${bloqueDetalle('Situaci√≥n Laboral', registro.situacionLaboral, true)}
                    ${bloqueDetalle('Otras Observaciones', registro.observaciones, true)}
                </div>
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="editarRegistro('${id}')">‚úèÔ∏è Editar</button>
                    <button class="btn btn-danger" onclick="eliminarRegistro('${id}')">üóëÔ∏è Eliminar</button>
                    <!-- NUEVO: bot√≥n Imprimir dentro del modal -->
                    <button class="btn btn-secondary" onclick="imprimirRegistro('${id}')">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
                </div>`;
            document.getElementById('modal').style.display = 'block';
        }
        function bloqueDetalle(label, value, largo = false) {
            const box = `<div style="padding: 12px; background: #f8fafc; border-radius: 8px; ${largo ? 'min-height:60px;' : ''}">${safe(value)}</div>`;
            return `<div class="form-group"><label>${label}</label>${box}</div>`;
        }

        // Editar
        function editarRegistro(id) {
            const registro = registros.find(r => r.id === id);
            if (!registro) return;
            Object.keys(registro).forEach(key => {
                const campo = document.getElementById(key);
                if (campo && key !== 'id') campo.value = registro[key] || '';
            });
            registroEditando = id;
            cerrarModal();
            document.querySelector('.card').scrollIntoView({ behavior: 'smooth' });
            mostrarNotificacion('Modo edici√≥n activado. Modifique los campos y guarde los cambios.', 'info');
        }

        // Eliminar
        function eliminarRegistro(id) {
            if (!confirm('¬øEst√° seguro de que desea eliminar este registro? Esta acci√≥n no se puede deshacer.')) return;
            database.ref('registros/' + id).remove()
                .then(() => { mostrarNotificacion('Registro eliminado exitosamente', 'success'); cargarTodosLosRegistros(); cerrarModal(); })
                .catch((error) => mostrarNotificacion('Error al eliminar: ' + error.message, 'error'));
        }

        // Limpieza y modal
        function limpiarFormulario() { document.getElementById('registroForm').reset(); registroEditando = null; }
        function cerrarModal() { document.getElementById('modal').style.display = 'none'; }

        // Notificaciones
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = mensaje;
            notification.className = `notification ${tipo}`;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 4000);
        }

        // Cerrar modal al clickear fuera
        window.onclick = function (event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) cerrarModal();
        };

        // --- NUEVO: Funciones de impresi√≥n ---
        function printListadoCompleto() {
            const vistaAnterior = vistaActual;
            if (vistaActual !== 'complete') cambiarVista('complete');
            // peque√±o tick para asegurar render
            setTimeout(() => {
                window.print();
                if (vistaAnterior !== 'complete') cambiarVista(vistaAnterior);
            }, 50);
        }

        function imprimirRegistro(id) {
            const r = registros.find(x => x.id === id);
            if (!r) return;
            const w = window.open('', '_blank');
            const estilo = `
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color:#111827; }
                    h1 { font-size: 20px; margin-bottom: 10px; }
                    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
                    .field { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
                    .label { font-weight: 600; color: #1d4ed8; margin-bottom: 6px; }
                    .value { white-space: pre-wrap; }
                    .span-2 { grid-column: 1 / -1; }
                </style>`;
            const celda = (l, v, span = false) => `<div class="field ${span ? 'span-2' : ''}"><div class="label">${l}</div><div class="value">${safe(v)}</div></div>`;
            const html = `
                <html><head><title>Registro</title>${estilo}</head><body>
                <h1>Detalle del Registro</h1>
                <div class="grid">
                    ${celda('Apellido', r.apellido)}
                    ${celda('Nombre', r.nombre)}
                    ${celda('DNI', r.dni)}
                    ${celda('Domicilio', r.domicilio)}
                    ${celda('Ciudad', r.ciudad)}
                    ${celda('Tel√©fono', r.telefono)}
                    ${celda('Email', r.email)}
                    ${celda('Datos Judiciales Antecedentes', r.datosAntecedentes, true)}
                    ${celda('Situaci√≥n M√©dica', r.situacionMedica, true)}
                    ${celda('Situaci√≥n Laboral', r.situacionLaboral, true)}
                    ${celda('Otras Observaciones', r.observaciones, true)}
                </div>
                <script>window.onload = () => { window.print(); window.close(); }<\/script>
                </body></html>`;
            w.document.open();
            w.document.write(html);
            w.document.close();
        }
    </script>
</body>
</html>
